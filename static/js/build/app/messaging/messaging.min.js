!function(e){function t(n){if(s[n])return s[n].exports;var r=s[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var s={};return t.m=e,t.c=s,t.i=function(e){return e},t.d=function(e,s,n){t.o(e,s)||Object.defineProperty(e,s,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var s=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(s,"a",s),s},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=6)}([function(e,t,s){"use strict";var n=angular.module("general.directives",[]);n.directive("alerts",[function(){return{restrict:"E",scope:{messages:"="},templateUrl:Urls["messaging_api:partial_base"]()+"directive/alerts",link:function(e,t){t.find("button").bind("click",function(){e.$apply(function(){e.class="",e.msg=""})})},controller:["$scope",function(e){e.class="",e.setMessage=function(t){e.messages[t]&&(e.msg=e.messages[t],e.class="alert-"+t,e.messages={})},angular.forEach(["success","danger","warning","info"],function(t){e.$watch("messages."+t,function(){e.setMessage(t)},!0)})}]}}]),n.directive("modalConfirm",[function(){return{restrict:"E",scope:{uid:"@",title:"@",body:"@",cancel:"&",confirm:"&"},templateUrl:Urls["messaging_api:partial_base"]()+"directive/modalConfirm"}}]),n.directive("pagination",[function(){return{restrict:"E",scope:{perPage:"@",currentPage:"=",total:"=",fetchPage:"&"},templateUrl:Urls["messaging_api:partial_base"]()+"directive/pagination",controller:["$scope",function(e){e.currentPage=0,e.pageCount=0,e.pages=[],e.calculatePageCount=function(){0===e.total?e.pageCount=1:e.pageCount=Math.ceil(e.total/e.perPage)},e.calculatePages=function(){var t,s,n;for(t=1,s=e.pageCount,e.pages=[],n=t;n<=s;++n)e.pages.push(n)},e.$watch("currentPage",function(){e.calculatePages()}),e.$watch("total",function(){e.calculatePageCount(),e.calculatePages()}),e.prevPage=function(){e.currentPage>0&&--e.currentPage},e.prevPageDisabled=function(){var t=0===e.currentPage?"disabled":"";return t},e.nextPage=function(){e.currentPage<e.pageCount-1&&e.currentPage++},e.nextPageDisabled=function(){var t=e.currentPage===e.pageCount-1?"disabled":"";return t},e.pageDisabled=function(t){var s=e.currentPage===t;return s},e.gotoPage=function(t){e.currentPage=t}}]}}])},function(e,t,s){"use strict";var n=angular.module("general.filters",[]);n.filter("raw",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}])},function(e,t,s){"use strict";var n=angular.module("general.services",[]);n.service("genericSrv",["$http","$q",function(e,t){this.genericGet=function(e){return this._genericVerb("get",e,{})},this.genericPost=function(e,t){return this._genericVerb("post",e,t)},this._genericVerb=function(s,n,r){var i=t.defer();return e[s](n,r).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise}}]),n.service("messageSrv",function(){this.messages={},this.collect=function(){var e={};return angular.copy(this.messages,e),this.messages={},e}})},function(e,t,s){"use strict";var n=angular.module("messagingApp",["messagingApp.controllers","messagingApp.services","general.directives","general.filters","general.services","ngRoute","ngSanitize"]);n.constant("CONFIG",window.CONFIG),delete window.CONFIG,n.config(["$routeProvider","$httpProvider",function(e,t){t.defaults.xsrfCookieName="csrftoken",t.defaults.xsrfHeaderName="X-CSRFToken",t.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",e.when("/",{templateUrl:Urls["messaging_api:partial_base"]()+"route/listMessages",controller:"listMessagesCtrl"}).when("/compose",{templateUrl:Urls["messaging_api:partial_base"]()+"route/composeMessage",controller:"composeMessageCtrl"}).when("/reply/:id",{templateUrl:Urls["messaging_api:partial_base"]()+"route/composeMessage",controller:"composeMessageCtrl"}).when("/read/:id",{templateUrl:Urls["messaging_api:partial_base"]()+"route/readThread",controller:"readThreadCtrl"}).otherwise({redirectTo:"/"})}])},function(e,t,s){"use strict";var n=angular.module("messagingApp.controllers",[]);n.controller("listMessagesCtrl",["$scope","$timeout","genericSrv","messageSrv","inboxSortSrv","CONFIG",function(e,t,s,n,r,i){e.perPage=10,e.inbox=null,e.total=0,e.currentPage=0,e.timeoutPromise=null,e.messages=n.collect(),e.sort=r.toFlags(),e.showMessageItemIds=i.showMessageItemIds,e.firstTime=!0,e.getPageOfInbox=function(){var n=Urls["messaging_api:get_inbox"]()+"?page="+e.currentPage+"&per_page="+e.perPage+"&sort_field="+r.sortField+"&sort_dir="+r.sortDirection;t.cancel(e.timeoutPromise),s.genericGet(n).then(function(t){e.inbox=t.messages,e.total=t.total,e.firstTime&&0===e.total&&(e.firstTime=!1,e.messages.info=i.trans.empty_inbox)},function(t){e.inbox=null,e.total=0,e.messages.danger=t.errorMessage}).finally(function(){e.timeoutPromise=t(function(){e.getPageOfInbox(e.currentPage)},1e4)})},e.setSort=function(t){t===r.sortField?r.toggleSortDirection():r.sortField=t,e.sort=r.toFlags(),e.getPageOfInbox(e.currentPage)},e.$watch("currentPage",function(t){e.getPageOfInbox(t)}),e.$on("$destroy",function(){t.cancel(e.timeoutPromise)})}]),n.controller("composeMessageCtrl",["$scope","$timeout","$location","$routeParams","genericSrv","messageSrv","CONFIG",function(e,t,s,n,r,i,a){if(e.timeoutPromise=e.sendTo=e.sendToChoices=null,e.currentPage=e.pageCount=e.sendToChoicesCount=0,e.pages=[],e.messages=i.collect(),e.searching=!1,e.minSearchChars=a.minSearchChars,e.isSuperUser=a.isSuperUser,e.replySender=null,e.replyTo=e.replyBody="",e.newMessage=!1,e.msg={recipients:[],targetAll:!1,subject:"",body:"",miid:n.id?n.id:0},e.msg.miid){var o=Urls["messaging_api:get_reply_info"]()+"?miid="+e.msg.miid;r.genericGet(o).then(function(t){e.msg.recipients=t.recipients,e.msg.subject=t.subject,e.replySender=t.recipients[0],e.replyTo=t.sender,e.replyBody=t.body},function(t){i.messages[t.type]=t.errorMessage,s.path("/read/"+e.msg.miid)})}else e.newMessage=!0;e.sendToKeyUp=function(){t.cancel(e.timeoutPromise),e.timeoutPromise=t(function(){e.searchRecipient()},500)},e.searchRecipient=function(){var t;e.sendTo&&(e.sendTo.length>=e.minSearchChars?(e.searching=!0,t={q:e.sendTo,recipients:e.msg.recipients,page:e.currentPage},r.genericPost(Urls["messaging_api:search_recipient"](),t).then(function(t){e.addChoices(t)},function(t){e.messages.danger=t.errorMessage,e.sendToChoices=null}).finally(function(){e.searching=!1})):e.sendTo.length<e.minSearchChars&&(e.sendToChoices=null))},e.addRecipient=function(t){e.msg.recipients.push(t),e.removeChoice(t),e.searchRecipient()},e.removeRecipient=function(t){e.msg.recipients=e.msg.recipients.filter(function(e){return e.id!==t.id}),e.searchRecipient()},e.addChoices=function(t){var s;for(e.sendToChoices=t.searchResults.filter(function(t){var s,n;for(s=0,n=e.msg.recipients.length;s<n;++s)if(e.msg.recipients[s].id===t.id)return!1;return!0}),e.sendToChoicesCount=t.count,e.pageCount=Math.ceil(t.count/t.perPage),e.pages=[],s=1;s<=e.pageCount;++s)e.pages.push(s)},e.removeChoice=function(t){e.sendToChoices=e.sendToChoices.filter(function(e){return e.id!==t.id})},e.targetAllChanged=function(){e.msg&&e.msg.targetAll&&(e.sendTo="",e.sendToChoices=[],e.msg.recipients=[])},e.sendMessage=function(){r.genericPost(Urls["messaging_api:send_message"](),e.msg).then(function(t){i.messages.success=t.successMessage,e.msg.miid?s.path("/read/"+e.msg.miid):s.path("/")},function(e){i.messages[e.type]=e.errorMessage,s.path("/")})},e.isSender=function(t){return!(!e.msg.miid||!e.replySender)&&t.id===e.replySender.id},e.$on("$destroy",function(){t.cancel(e.timeoutPromise)}),e.prevPage=function(){e.currentPage>0&&(--e.currentPage,e.searchRecipient())},e.prevPageDisabled=function(){var t=0===e.currentPage?"disabled":"";return t},e.nextPage=function(){e.currentPage<e.pageCount-1&&(e.currentPage++,e.searchRecipient())},e.nextPageDisabled=function(){var t=e.currentPage===e.pageCount-1?"disabled":"";return t},e.pageDisabled=function(t){return e.currentPage===t},e.gotoPage=function(t){e.currentPage=t,e.searchRecipient()}}]),n.controller("readThreadCtrl",["$scope","$timeout","$location","$routeParams","genericSrv","messageSrv","CONFIG",function(e,t,s,n,r,i,a){e.messageItemId=n.id,e.messages=i.collect(),e.timeoutPromise=null,e.showMessageItemIds=a.showMessageItemIds,e.unread=[],e.getThread=function(){var o=Urls["messaging_api:get_thread"]()+"?miid="+n.id;t.cancel(e.timeoutPromise),r.genericGet(o).then(function(s){e.subject=s.subject,e.thread=s.messages,e.storeUnread(),e.total=s.total,0===e.total&&(e.messages.info=a.trans.empty_thread),e.timeoutPromise=t(function(){e.getThread()},1e4)},function(e){i.messages[e.type]=e.errorMessage,s.path("/")})},e.getThread(),e.storeUnread=function(){var t,s;for(t=0,s=e.thread.length;t<s;++t)e.thread[t].read||e.unread.indexOf(e.thread[t].id)!==-1||e.unread.push(e.thread[t].id)},e.isRead=function(t){return e.unread.indexOf(t.id)===-1},e.openModal=function(s,n){t.cancel(e.timeoutPromise),e.miid=n,jQuery("#"+s).modal({})},e.cancelDeleteMessage=function(t){var s=jQuery("#"+t);s.off("hidden.bs.modal"),s.on("hidden.bs.modal",function(){e.getThread()}),s.modal("hide")},e.deleteOne=function(t){var s,n=jQuery("#"+t);n.off("hidden.bs.modal"),n.on("hidden.bs.modal",function(){var t=e.miid;e.miid=null,t&&(s=Urls["messaging_api:delete_message_item"]()+"?miid="+t,r.genericGet(s).then(function(t){e.messages.success=t.successMessage},function(t){e.messages[t.type]=t.errorMessage}).finally(function(){e.getThread()}))}),n.modal("hide")},e.deleteAll=function(t){var n,a=jQuery("#"+t);a.off("hidden.bs.modal"),a.on("hidden.bs.modal",function(){e.total&&(n=Urls["messaging_api:delete_message_item"]()+"?miid="+e.thread[0].id+"&thread",r.genericGet(n).then(function(e){i.messages.success=e.successMessage,s.path("/")},function(t){e.messages[t.type]=t.errorMessage,e.getThread()}))}),a.modal("hide")},e.$on("$destroy",function(){t.cancel(e.timeoutPromise)})}])},function(e,t,s){"use strict";var n=angular.module("messagingApp.services",[]);n.service("inboxSortSrv",function(){this.sortField="date",this.sortDirection="desc",this.toFlags=function(){return{sender:"sender"===this.sortField,senderAsc:"sender"===this.sortField&&"asc"===this.sortDirection,senderDesc:"sender"===this.sortField&&"desc"===this.sortDirection,date:"date"===this.sortField,dateAsc:"date"===this.sortField&&"asc"===this.sortDirection,dateDesc:"date"===this.sortField&&"desc"===this.sortDirection}},this.toggleSortDirection=function(){"asc"===this.sortDirection?this.sortDirection="desc":this.sortDirection="asc"}})},function(e,t,s){"use strict";s(3),s(4),s(5),s(0),s(1),s(2)}]);
//# sourceMappingURL=messaging.min.js.map